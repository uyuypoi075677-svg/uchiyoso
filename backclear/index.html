<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChromaCleanse Pro - Expert BG Remover</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div id="app">
        <header class="main-header">
            <div class="logo">
                <span class="logo-icon">üíé</span>
                <h1>ChromaCleanse <span>PRO</span></h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" id="compareBtn">Before / After</button>
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/></svg>
                    ÁîªÂÉè„ÇíÈñã„Åè
                </button>
                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(this)">
            </div>
        </header>

        <main class="workspace">
            <!-- Sidebar Left: Tools & Masking -->
            <aside class="sidebar sidebar-left">
                <div class="scroll-content">
                    <section class="tool-section">
                        <h3 class="label">„É°„Ç§„É≥„ÉÑ„Éº„É´</h3>
                        <div class="tools-grid">
                            <button class="tool-btn active" id="btn-pan" onclick="setTool('pan')" title="ÁßªÂãï (H)">
                                <svg viewBox="0 0 24 24"><path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"/></svg>
                                <span>ÁßªÂãï</span>
                            </button>
                            <button class="tool-btn" id="btn-dropper" onclick="setTool('dropper')" title="„Çπ„Éù„Ç§„Éà (I)">
                                <svg viewBox="0 0 24 24"><path d="M20.71 5.63l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-3.12 3.12-1.93-1.91-1.41 1.41 1.42 1.42L3 16.25V21h4.75l8.92-8.92 1.42 1.42 1.41-1.41-1.92-1.92 3.12-3.12c.4-.4.4-1.03.01-1.42z"/></svg>
                                <span>„Çπ„Éù„Ç§„Éà</span>
                            </button>
                            <button class="tool-btn" id="btn-wand" onclick="setTool('wand')" title="È≠îÊ≥ï„ÅÆÊùñ (W)">
                                <svg viewBox="0 0 24 24"><path d="M7.5 5.6L10 7 8.6 4.5 10 2 7.5 3.4 5 2 6.4 4.5 5 7zM19.5 15.4L22 14l-2.5-1.4L21 10l-2.6 1.5L16 10l1.4 2.6L16 14l2.5 1.4zM14.5 8.24l-7.78-6.03z"/></svg>
                                <span>Êùñ</span>
                            </button>
                            <button class="tool-btn" id="btn-eraser" onclick="setTool('eraser')" title="Ê∂à„Åó„Ç¥„É† (E)">
                                <svg viewBox="0 0 24 24"><path d="M15.14 3c-.51 0-1.02.2-1.41.59L2.59 14.73c-.78.78-.78 2.05 0 2.83L5.03 20h7.66l8.72-8.72c.79-.78.79-2.05 0-2.83l-4.85-4.86c-.39-.39-.91-.59-1.42-.59z"/></svg>
                                <span>Ê∂à„Åó„Ç¥„É†</span>
                            </button>
                            <button class="tool-btn" id="btn-protect" onclick="setTool('protect')" title="‰øùË≠∑ (P)">
                                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                                <span>‰øùË≠∑</span>
                            </button>
                            <button class="tool-btn" id="btn-rect" onclick="setTool('rect')" title="Áü©ÂΩ¢Ê∂àÂéª (R)">
                                <svg viewBox="0 0 24 24"><path d="M3 3h18v18H3V3zm16 16V5H5v14h14z"/></svg>
                                <span>Áü©ÂΩ¢</span>
                            </button>
                        </div>
                    </section>

                    <section class="control-panel">
                        <h3 class="label">ÈÄèÈÅé„Ç¢„É´„Ç¥„É™„Ç∫„É†</h3>
                        <button class="btn btn-magic" onclick="autoDetectBackground()">
                            <span>‚ú® Ëá™ÂãïËÉåÊôØÈô§Âéª</span>
                        </button>
                        
                        <div class="input-group">
                            <div class="input-header">
                                <span>Âü∫Ê∫ñ„Ç´„É©„Éº</span>
                                <div class="color-swatch" id="bgColorPreview">
                                    <input type="color" id="bgColorInput" value="#00FF00" oninput="changeBgColor(this.value)">
                                </div>
                            </div>
                            <label class="toggle-row">
                                <input type="checkbox" id="contiguousMode" onchange="runProcess()">
                                <span class="custom-toggle"></span>
                                <span class="toggle-text">Èö£Êé•È†òÂüü„ÅÆ„Åø</span>
                            </label>
                        </div>

                        <div class="slider-group">
                            <div class="slider-header">Ë®±ÂÆπÁØÑÂõ≤ <span class="val" id="v-thresh">30</span></div>
                            <input type="range" id="s-thresh" min="0" max="100" value="30" oninput="updateVal('v-thresh', this.value)" onchange="runProcess()">
                        </div>
                        <div class="slider-group">
                            <div class="slider-header">Â¢ÉÁïå„ÅÆ„Åº„Åã„Åó <span class="val" id="v-soft">0</span></div>
                            <input type="range" id="s-soft" min="0" max="50" value="0" oninput="updateVal('v-soft', this.value)" onchange="runProcess()">
                        </div>
                        <div class="slider-group">
                            <div class="slider-header">„Ç®„ÉÉ„Ç∏Êªë„Çâ„Åã <span class="val" id="v-smooth">0</span></div>
                            <input type="range" id="s-smooth" min="0" max="10" value="0" step="1" oninput="updateVal('v-smooth', this.value)" onchange="runProcess()">
                        </div>
                        <div class="slider-group">
                            <div class="slider-header">Ëâ≤Ë¢´„ÇäÈô§Âéª <span class="val" id="v-spill">0</span></div>
                            <input type="range" id="s-spill" min="0" max="100" value="0" oninput="updateVal('v-spill', this.value)" onchange="runProcess()">
                        </div>
                    </section>

                    <section class="control-panel">
                        <h3 class="label">Ë£úÊ≠£Ë™øÊï¥</h3>
                        <div class="slider-group small">
                            <div class="slider-header">Êòé„Çã„Åï <span class="val" id="v-bright">100</span></div>
                            <input type="range" id="s-bright" min="50" max="150" value="100" oninput="updateVal('v-bright', this.value)" onchange="runProcess()">
                        </div>
                        <div class="slider-group small">
                            <div class="slider-header">„Ç≥„É≥„Éà„É©„Çπ„Éà <span class="val" id="v-contrast">100</span></div>
                            <input type="range" id="s-contrast" min="50" max="150" value="100" oninput="updateVal('v-contrast', this.value)" onchange="runProcess()">
                        </div>
                    </section>
                </div>
            </aside>

            <!-- Center: Canvas View -->
            <section class="canvas-container" id="canvasContainer">
                <div class="canvas-top-bar">
                    <div class="canvas-info" id="img-info">Waiting for image...</div>
                    <div class="view-controls">
                        <label class="toggle-row">
                            <input type="checkbox" id="maskViewMode" onchange="runProcess()">
                            <span class="custom-toggle mini"></span>
                            <span class="toggle-text">„Éû„Çπ„ÇØË°®Á§∫</span>
                        </label>
                        <div class="separator"></div>
                        <div class="bg-presets">
                            <button class="bg-btn checker" onclick="setCanvasBg('checker')" title="ÈÄèÊòé"></button>
                            <button class="bg-btn white" onclick="setCanvasBg('white')" title="ÁôΩ"></button>
                            <button class="bg-btn black" onclick="setCanvasBg('black')" title="Èªí"></button>
                            <div class="bg-btn custom" id="customBgBtn">
                                <input type="color" id="customBgInput" value="#FF4081">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="viewport">
                    <div id="canvasWrapper">
                        <canvas id="mainCanvas"></canvas>
                    </div>
                    <div id="loadingOverlay" class="loading-overlay">
                        <div class="spinner"></div>
                        <p id="loadingText">Processing...</p>
                    </div>
                    <div id="dropZone" class="drop-zone">
                        <div class="drop-icon">üìÅ</div>
                        <p>ÁîªÂÉè„Çí„Éâ„É≠„ÉÉ„Éó„Åó„Å¶ÈñãÂßã</p>
                    </div>
                </div>

                <div class="bottom-toolbar">
                    <div class="history-controls">
                        <button class="icon-btn" id="undoBtn" onclick="undo()" disabled title="Êàª„Åô (Ctrl+Z)">‚Ü©Ô∏è</button>
                        <button class="icon-btn" id="redoBtn" onclick="redo()" disabled title="ÈÄ≤„ÇÄ (Ctrl+Y)">‚Ü™Ô∏è</button>
                    </div>
                    <div class="zoom-info" id="zoomVal">100%</div>
                </div>
            </section>

            <!-- Sidebar Right: Export & Finish -->
            <aside class="sidebar sidebar-right">
                <div class="scroll-content">
                    <section class="control-panel border-box">
                        <h3 class="label">Á∏ÅÂèñ„ÇäË®≠ÂÆö</h3>
                        <div class="toggle-header">
                            <span>ÊúâÂäπ„Å´„Åô„Çã</span>
                            <label class="toggle-row no-text">
                                <input type="checkbox" id="enableBorder" onchange="toggleBorder()">
                                <span class="custom-toggle"></span>
                            </label>
                        </div>
                        <div id="border-controls" class="sub-panel disabled">
                            <div class="input-header">
                                <span>Ëâ≤</span>
                                <div class="color-swatch" id="borderColorPreview">
                                    <input type="color" id="borderColorInput" value="#FFFFFF" oninput="runProcess()">
                                </div>
                            </div>
                            <div class="slider-group">
                                <div class="slider-header">Â§™„Åï <span class="val" id="v-border">0</span></div>
                                <input type="range" id="s-border" min="0" max="30" value="0" oninput="updateVal('v-border', this.value); runProcess();">
                            </div>
                        </div>
                    </section>

                    <section class="control-panel slice-box">
                        <h3 class="label">„Ç∞„É™„ÉÉ„ÉâÂàÜÂâ≤‰øùÂ≠ò</h3>
                        <label class="toggle-row">
                            <input type="checkbox" id="sliceModeToggle" onchange="toggleSliceMode()">
                            <span class="custom-toggle"></span>
                            <span class="toggle-text">„Ç¨„Ç§„ÉâÁ∑®ÈõÜ</span>
                        </label>
                        <div id="slice-controls-area" class="sub-panel disabled">
                            <div class="grid-inputs">
                                <span>Ê®™ <input type="number" id="sliceCols" value="2" min="1"></span>
                                <span>Á∏¶ <input type="number" id="sliceRows" value="2" min="1"></span>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="initGridLines()">„É™„Çª„ÉÉ„Éà</button>
                            <button class="btn btn-primary btn-sm" onclick="sliceAndZip()">‚úÇÔ∏è ÂàÜÂâ≤ZIP‰øùÂ≠ò</button>
                        </div>
                    </section>

                    <section class="export-panel">
                        <h3 class="label">„Ç®„ÇØ„Çπ„Éù„Éº„Éà</h3>
                        <label class="toggle-row">
                            <input type="checkbox" id="autoTrim" checked>
                            <span class="custom-toggle"></span>
                            <span class="toggle-text">Ëá™Âãï„Éà„É™„Éü„É≥„Ç∞</span>
                        </label>
                        <button class="btn btn-download" id="downloadBtn" onclick="downloadImage()" disabled>
                            PNG„Åß‰øùÂ≠ò
                        </button>
                        <button class="btn btn-outline" onclick="setTool('crop')">‚õ∂ ÁØÑÂõ≤ÊåáÂÆö‰øùÂ≠ò</button>
                        <button class="btn btn-orange" id="autoCutBtn" onclick="autoCutAndZip()" disabled>
                            üß© Ëá™Âãï„Éë„Éº„ÉÑÂàÜÂâ≤ (ZIP)
                        </button>
                    </section>
                </div>
            </aside>
        </main>
    </div>

    <!-- Cursors -->
    <div id="eraser-cursor" class="custom-cursor cursor-eraser"></div>
    <div id="protect-cursor" class="custom-cursor cursor-protect"></div>

    <script src="script.js"></script>
</body>
</html>