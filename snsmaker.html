<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uchiyoso SNS Maker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #4f46e5;
            --bg-color: #f3f4f6;
            --chat-bg: #7494c0; /* LINEé¢¨ã®èƒŒæ™¯è‰² */
            --my-bubble: #8de055;
            --other-bubble: #ffffff;
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #e0e7ff;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            gap: 40px;
        }

        /* --- ã‚¨ãƒ‡ã‚£ã‚¿ã‚¨ãƒªã‚¢ (å·¦å´) --- */
        .editor-panel {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 350px;
            position: sticky;
            top: 20px;
        }
        h1 { font-size: 1.2rem; margin-top: 0; color: var(--primary-color); }
        
        .control-group { margin-bottom: 16px; }
        label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 6px; }
        
        select, input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        
        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        .btn-add { background-color: var(--primary-color); color: white; }
        .btn-add:hover { background-color: #4338ca; }
        
        .btn-save { background-color: #10b981; color: white; margin-top: 20px; width: 100%; }
        .btn-clear { background-color: #ef4444; color: white; }

        /* --- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ (å³å´ãƒ»ã‚¹ãƒãƒ›ç”»é¢) --- */
        .preview-container {
            width: 375px; /* ä¸€èˆ¬çš„ãªã‚¹ãƒãƒ›å¹… */
            height: 700px; /* ã‚¹ãƒãƒ›ç¸¦å¹… */
            background-color: #000;
            border-radius: 30px;
            padding: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            position: relative;
        }

        /* ã‚¹ãƒãƒ›ç”»é¢ã®ä¸­èº« */
        #capture-area {
            width: 100%;
            height: 100%;
            background-color: var(--chat-bg);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼é¢¨ */
        .chat-header {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
            border-bottom: 1px solid #ccc;
            z-index: 10;
        }

        /* ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ */
        .chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* å¹ãå‡ºã—å…±é€š */
        .message-row {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            max-width: 100%;
        }

        .icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ccc;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
        }

        .bubble {
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.4;
            max-width: 240px;
            position: relative;
            word-wrap: break-word;
            white-space: pre-wrap; /* æ”¹è¡Œã‚’åæ˜  */
        }
        
        .name-label {
            font-size: 0.7rem;
            color: #333;
            margin-bottom: 4px;
            margin-left: 2px;
        }

        /* ç›¸æ‰‹ï¼ˆå·¦å´ï¼‰ */
        .message-row.other .bubble {
            background-color: var(--other-bubble);
            color: #000;
            border-top-left-radius: 2px;
        }

        /* è‡ªåˆ†ï¼ˆå³å´ï¼‰ */
        .message-row.me {
            flex-direction: row-reverse;
        }
        .message-row.me .bubble {
            background-color: var(--my-bubble);
            color: #000;
            border-top-right-radius: 2px;
        }
        .message-row.me .name-label, 
        .message-row.me .icon {
            display: none; /* è‡ªåˆ†å´ã®ã‚¢ã‚¤ã‚³ãƒ³ãƒ»åå‰ã¯é€šå¸¸å‡ºã•ãªã„ */
        }

        /* ç”»åƒç”Ÿæˆæ™‚ã®éš ã—è¦ç´ åˆ¶å¾¡ */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>

    <div class="editor-panel">
        <h1>ğŸ’¬ Uchiyoso Maker</h1>
        
        <div class="control-group">
            <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ</label>
            <select id="char-select"></select>
        </div>

        <div class="control-group">
            <label>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹</label>
            <textarea id="message-input" rows="3" placeholder="ã“ã“ã«ã‚»ãƒªãƒ•ã‚’å…¥åŠ›..."></textarea>
        </div>

        <div class="btn-group">
            <button class="btn-add" onclick="addMessage()">é€ä¿¡ (è¿½åŠ )</button>
            <button class="btn-clear" onclick="undoMessage()">1ã¤æˆ»ã‚‹</button>
        </div>

        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">

        <div class="control-group">
            <label>è¨­å®š</label>
            <input type="text" id="group-name" placeholder="ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ å (ä¾‹: ã„ã¤ã‚‚ã®4äºº)" oninput="updateHeader()">
        </div>

        <button class="btn-save" onclick="saveImage()">ğŸ“¸ ç”»åƒã¨ã—ã¦ä¿å­˜</button>
    </div>

    <div class="preview-container">
        <div id="capture-area">
            <div class="chat-header" id="header-title">ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ </div>
            <div class="chat-body hide-scrollbar" id="chat-body">
                </div>
        </div>
    </div>

    <script>
        // --- 1. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š (ã“ã“ã‚’è‡ªç”±ã«æ›¸ãæ›ãˆã¦ãã ã•ã„) ---
        const characters = [
            { 
                id: 'char1', 
                name: 'ä¸»äººå…¬', 
                icon: 'https://placehold.co/100x100/4f46e5/white?text=YOU', // è‡ªåˆ†ã®ã‚¢ã‚¤ã‚³ãƒ³URL
                isMe: true // è‡ªåˆ†ã®å ´åˆã¯true
            },
            { 
                id: 'char2', 
                name: 'ãƒ’ãƒ­ã‚¤ãƒ³', 
                icon: 'https://placehold.co/100x100/ec4899/white?text=A', // ç›¸æ‰‹Aã®ã‚¢ã‚¤ã‚³ãƒ³URL
                isMe: false 
            },
            { 
                id: 'char3', 
                name: 'è¦ªå‹ã‚­ãƒ£ãƒ©', 
                icon: 'https://placehold.co/100x100/10b981/white?text=B', // ç›¸æ‰‹Bã®ã‚¢ã‚¤ã‚³ãƒ³URL
                isMe: false 
            }
        ];

        // --- 2. åˆæœŸåŒ–å‡¦ç† ---
        const charSelect = document.getElementById('char-select');
        const chatBody = document.getElementById('chat-body');
        const messageInput = document.getElementById('message-input');

        // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«ã‚­ãƒ£ãƒ©ã‚’è¿½åŠ 
        characters.forEach(char => {
            const option = document.createElement('option');
            option.value = char.id;
            option.textContent = char.name + (char.isMe ? " (è‡ªåˆ†)" : "");
            charSelect.appendChild(option);
        });

        // --- 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ æ©Ÿèƒ½ ---
        function addMessage() {
            const text = messageInput.value;
            if (!text.trim()) return;

            const selectedCharId = charSelect.value;
            const char = characters.find(c => c.id === selectedCharId);

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´ ã‚’ä½œæˆ
            const row = document.createElement('div');
            row.className = `message-row ${char.isMe ? 'me' : 'other'}`;

            // ã‚¢ã‚¤ã‚³ãƒ³ã¨åå‰ï¼ˆç›¸æ‰‹ã®å ´åˆã®ã¿è¡¨ç¤ºï¼‰
            let innerHTML = '';
            if (!char.isMe) {
                innerHTML += `
                    <div class="icon" style="background-image: url('${char.icon}')"></div>
                    <div>
                        <div class="name-label">${char.name}</div>
                        <div class="bubble">${escapeHtml(text)}</div>
                    </div>
                `;
            } else {
                // è‡ªåˆ†ã®å ´åˆ
                innerHTML += `
                    <div class="bubble">${escapeHtml(text)}</div>
                `;
            }

            row.innerHTML = innerHTML;
            chatBody.appendChild(row);

            // æœ€ä¸‹éƒ¨ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            chatBody.scrollTop = chatBody.scrollHeight;
            
            // å…¥åŠ›æ¬„ã‚¯ãƒªã‚¢
            messageInput.value = '';
        }

        // --- 4. ã²ã¨ã¤æˆ»ã‚‹æ©Ÿèƒ½ ---
        function undoMessage() {
            if (chatBody.lastChild) {
                chatBody.removeChild(chatBody.lastChild);
            }
        }

        // --- 5. ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–° ---
        function updateHeader() {
            document.getElementById('header-title').textContent = document.getElementById('group-name').value || 'ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ';
        }

        // --- 6. ç”»åƒä¿å­˜æ©Ÿèƒ½ (html2canvasä½¿ç”¨) ---
        function saveImage() {
            const captureArea = document.getElementById('capture-area');
            
            // ä¸€ç¬ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ãªã©ã‚’éè¡¨ç¤ºã«ã—ã¦æ’®å½±
            html2canvas(captureArea, {
                scale: 2, // é«˜è§£åƒåº¦ã§ä¿å­˜
                useCORS: true, // å¤–éƒ¨ç”»åƒè¨±å¯
                backgroundColor: null
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'uchiyoso_chat.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // XSSå¯¾ç­–ç”¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•°
        function escapeHtml(str) {
            if(!str) return str;
            return str.replace(/[&<>"']/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                }[m];
            });
        }
    </script>
</body>
</html>