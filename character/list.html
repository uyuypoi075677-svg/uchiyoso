<!-- --- START OF FILE list.html --- -->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQUAD SELECT - DATABASE</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Teko:wght@400;600&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <link href="list/header.css" rel="stylesheet">

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg-color: #0b0c10;
            --card-width: 260px; /* „Ç´„Éº„ÉâÂπÖ„ÇíÂ∞ë„ÅóÂ∫É„Åí„Å¶Á©∫Èñì„Çí‰Ωú„Çã */
            --card-height: 65vh;
            --gap: 40px; /* „Ç´„Éº„ÉâÈñì„ÅÆ‰ΩôÁôΩ„ÇíÂ∫É„Åí„Çã */
            
            --neon-blue: #00f3ff;
            --neon-yellow: #ffd700;
            --neon-red: #ff2a2a;
            --glass-bg: rgba(20, 30, 40, 0.7);
            
            --depth-monitor: -60px;
            --depth-figure: 20px;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(circle at 50% 0%, #1f2833 0%, #0b0c10 80%),
                linear-gradient(0deg, rgba(0,243,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,243,255,0.03) 1px, transparent 1px);
            background-size: 100% 100%, 50px 50px, 50px 50px;
            background-position: center top, center center, center center;
            font-family: 'Rajdhani', 'Noto Sans JP', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex; flex-direction: column;
            color: #fff;
        }

        /* --- UI ELEMENTS --- */
        .sub-header {
            width: 100%; height: 50px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; box-sizing: border-box;
            background: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(0,243,255,0.1) 50%, rgba(0,0,0,0) 100%);
            border-bottom: 1px solid rgba(0,243,255,0.2);
            font-family: 'Teko', sans-serif; letter-spacing: 0.2em; font-size: 1.2rem;
            text-shadow: 0 0 10px var(--neon-blue);
            z-index: 100;
        }

        /* --- 3D STAGE AREA --- */
        .stage-wrapper {
            flex: 1; position: relative; width: 100%;
            display: flex; align-items: center; justify-content: center;
            perspective: 1200px; /* 3DÊ∑±Â∫¶„ÅÆÂº∑Âåñ */
            overflow: hidden;
        }

        /* Â∫ä„ÅÆ„Ç∞„É™„ÉÉ„ÉâÊºîÂá∫ */
        .floor-grid {
            position: absolute; bottom: -20%; left: -50%; width: 200%; height: 100%;
            background: 
                linear-gradient(rgba(0,243,255,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,243,255,0.1) 1px, transparent 1px);
            background-size: 80px 80px;
            transform: rotateX(70deg);
            mask-image: linear-gradient(to top, rgba(0,0,0,1) 0%, transparent 60%);
            -webkit-mask-image: linear-gradient(to top, rgba(0,0,0,1) 0%, transparent 60%);
            pointer-events: none; z-index: 0;
            animation: gridScroll 20s linear infinite;
        }
        @keyframes gridScroll { from { transform: rotateX(70deg) translateY(0); } to { transform: rotateX(70deg) translateY(80px); } }

        .stage-container {
            display: flex; align-items: center;
            padding: 0 10vw; /* Ê®™„Çπ„ÇØ„É≠„Éº„É´„ÅÆ‰ΩôÁôΩ */
            overflow-x: auto; 
            overflow-y: visible;
            scroll-behavior: smooth;
            height: 100%; width: 100%;
            transform-style: preserve-3d;
            scrollbar-width: none;
        }
        .stage-container::-webkit-scrollbar { display: none; }

        /* --- CHARACTER UNIT (THE SCENE) --- */
        .char-unit {
            flex: 0 0 var(--card-width);
            height: var(--card-height);
            margin: 0 var(--gap);
            position: relative;
            transform-style: preserve-3d; /* ÈáçË¶Å: Â≠êË¶ÅÁ¥†„Çí3DÈÖçÁΩÆ */
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
        }

        /* 1. BACK MONITOR (Screen) */
        .unit-monitor {
            position: absolute;
            top: 0; left: 0; right: 0; height: 75%; /* „É¢„Éã„Çø„Éº„ÅØ‰∏äÈÉ®3/4„ÇíÂç†„ÇÅ„Çã */
            background-color: #111;
            transform: translateZ(var(--depth-monitor)); /* Â••„Å´ÈÖçÁΩÆ */
            border: 1px solid rgba(255,255,255,0.1);
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            transition: all 0.4s ease;
        }
        .monitor-frame {
            position: absolute; inset: 0;
            border: 1px solid var(--neon-blue);
            opacity: 0.3; pointer-events: none; z-index: 5;
            box-shadow: inset 0 0 30px rgba(0, 243, 255, 0.05);
        }
        .monitor-corner {
            position: absolute; width: 10px; height: 10px;
            border-color: var(--neon-blue); border-style: solid;
            transition: all 0.3s;
        }
        .mc-tl { top: 0; left: 0; border-width: 2px 0 0 2px; }
        .mc-br { bottom: 0; right: 0; border-width: 0 2px 2px 0; }
        
        .monitor-img {
            width: 100%; height: 100%;
            background-size: cover; background-position: center top;
            opacity: 0.4; filter: grayscale(1) contrast(1.2) blur(1px);
            transition: all 0.5s ease;
        }
        /* Ëµ∞ÊüªÁ∑ö„Ç®„Éï„Çß„ÇØ„Éà */
        .scanlines {
            position: absolute; inset: 0;
            background: repeating-linear-gradient(
                0deg, transparent, transparent 2px, rgba(0,0,0,0.3) 3px
            );
            pointer-events: none; z-index: 2; opacity: 0.7;
        }

        /* 2. FLOOR & LIGHTING (Bottom) */
        .unit-floor {
            position: absolute; bottom: -20px; left: 50%;
            transform: translateX(-50%) rotateX(70deg) translateZ(-30px);
            width: 220px; height: 220px;
            background: radial-gradient(circle, rgba(0,243,255,0.2) 0%, transparent 60%);
            border-radius: 50%;
            filter: blur(5px);
            transition: all 0.5s ease;
            z-index: 1; pointer-events: none;
        }
        
        /* 3. FIGURE (Front) */
        .unit-figure-wrapper {
            position: absolute; 
            bottom: 0; left: 50%;
            transform: translateX(-50%) translateZ(var(--depth-figure));
            height: 60%; /* Ë∫´Èï∑Ë®≠ÂÆöÔºöÁîªÈù¢‰∏ãÈÉ®„Åã„ÇâÁ´ã„Å°‰∏ä„Åå„Çã */
            width: 100%;
            display: flex; justify-content: center; align-items: flex-end;
            z-index: 10; pointer-events: none;
            transition: transform 0.4s ease;
        }
        
        .char-img {
            max-height: 100%; width: auto; max-width: 200%;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5));
            mask-image: linear-gradient(to bottom, black 90%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 90%, transparent 100%);
            object-fit: contain;
            transition: transform 0.3s;
        }

        /* „É™„Ç¢„É´„Å™ÂΩ± */
        .char-shadow-real {
            position: absolute; bottom: 0; left: 50%;
            width: 120px; height: 30px;
            background: rgba(0,0,0,0.8);
            border-radius: 50%;
            transform: translateX(-50%) translateY(-50%) scaleY(0.5);
            filter: blur(6px);
            z-index: 9;
        }

        /* 4. INFO UI (Floating) */
        .unit-info {
            position: absolute; top: 20px; left: -10px;
            transform: translateZ(10px); /* Â∞ë„Åó„Å†„ÅëÊµÆ„Åã„Åô */
            z-index: 12;
            text-align: left;
        }
        .info-job {
            font-family: 'Teko', sans-serif; font-size: 0.9rem;
            background: var(--neon-blue); color: #000;
            padding: 2px 8px; display: inline-block;
            margin-bottom: 5px; clip-path: polygon(0 0, 100% 0, 90% 100%, 0% 100%);
        }
        .info-name {
            font-family: 'Noto Sans JP', sans-serif; font-weight: 700;
            font-size: 1.4rem; color: #fff;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.6);
            padding: 0 10px; border-left: 3px solid var(--neon-blue);
        }

        /* --- HOVER EFFECTS --- */
        .char-unit:hover {
            z-index: 50;
        }
        /* „É¢„Éã„Çø„Éº„Åå„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´ */
        .char-unit:hover .unit-monitor {
            border-color: var(--neon-blue);
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.2);
            transform: translateZ(-50px) scale(1.02); /* Â∞ë„ÅóËøë„Å•„Åè */
        }
        .char-unit:hover .monitor-img {
            opacity: 0.8; filter: grayscale(0) blur(0);
            transform: scale(1.05);
        }
        .char-unit:hover .monitor-frame { opacity: 0.8; }
        
        /* Â∫ä„ÅåÊòé„Çã„Åè */
        .char-unit:hover .unit-floor {
            background: radial-gradient(circle, rgba(0,243,255,0.5) 0%, transparent 70%);
            transform: translateX(-50%) rotateX(70deg) translateZ(-30px) scale(1.2);
        }

        /* „Éï„Ç£„ÇÆ„É•„Ç¢„ÅåÂº∑Ë™ø */
        .char-unit:hover .unit-figure-wrapper {
            transform: translateX(-50%) translateZ(40px) scale(1.05);
        }

        /* --- CONTROLS --- */
        .nav-btn {
            position: absolute; top: 50%; width: 60px; height: 60px;
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2);
            color: var(--neon-blue); font-size: 1.5rem; display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 100; transition: all 0.3s;
            backdrop-filter: blur(5px); clip-path: polygon(20% 0, 100% 0, 100% 80%, 80% 100%, 0 100%, 0 20%);
        }
        .nav-btn:hover { background: rgba(0, 243, 255, 0.2); text-shadow: 0 0 10px var(--neon-blue); border-color: var(--neon-blue); }
        .nav-btn.prev { left: 30px; }
        .nav-btn.next { right: 30px; }

        .edit-img-btn {
            position: absolute; top: 10px; right: 10px;
            width: 30px; height: 30px; border-radius: 50%;
            background: #222; border: 1px solid #555; color: #fff;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: 0.2s; z-index: 200; cursor: pointer;
        }
        .edit-img-btn:hover { border-color: var(--neon-blue); color: var(--neon-blue); }
        .char-unit:hover .edit-img-btn { opacity: 1; }

        .click-overlay { position: absolute; inset: 0; z-index: 20; cursor: pointer; }

        /* PARTICLES */
        #particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .particle {
            position: absolute; background: white; border-radius: 50%;
            opacity: 0; animation: rise 8s infinite ease-in;
        }
        @keyframes rise {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: translateY(-10vh) scale(1); opacity: 0; }
        }

        .loading-text {
            font-family: 'Teko', sans-serif; font-size: 2rem; color: #555; letter-spacing: 0.5em;
            text-align: center; animation: pulse 1s infinite alternate;
        }
        @keyframes pulse { from { opacity: 0.5; } to { opacity: 1; } }

    </style>
</head>
<body>

<script type="module">
    import { initHeader } from "./header.js"; 
    initHeader();
</script>

    <!-- Header UI -->
    <div class="sub-header">
        <span>SQUAD SELECTION</span>
        <span style="font-size: 0.9rem; opacity: 0.7;">// DATABASE ACCESS: AUTHORIZED</span>
    </div>
    
    <div id="particles"></div>

    <div class="stage-wrapper">
        <!-- Â∫ä„ÅÆ„Ç∞„É™„ÉÉ„ÉâÔºàËÉåÊôØÊºîÂá∫Ôºâ -->
        <div class="floor-grid"></div>

        <div class="nav-btn prev" id="btnPrev">‚óÄ</div>
        
        <div class="stage-container" id="stage">
            <div class="loading-text">INITIALIZING...</div>
        </div>
        
        <div class="nav-btn next" id="btnNext">‚ñ∂</div>
    </div>

    <!-- Footer UI -->
    <div class="sub-header" style="height: 40px; border-top: 1px solid #333; border-bottom: none; background: #000; justify-content: center;">
        <span style="font-size: 0.8rem; color: #666; letter-spacing: 0.2em;">SELECT CHARACTER TO VIEW DETAILS</span>
    </div>

    <script type="module">
        // firestore.js„ÅÆ„Éë„Çπ„ÅØÁí∞Â¢É„Å´Âêà„Çè„Åõ„Å¶Ë™øÊï¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        import { loadFromCloud, saveToCloud } from "./firestore.js";

        const stage = document.getElementById('stage');

        // ËÅ∑Ê•≠„Åî„Å®„ÅÆ„Ç´„É©„ÉºÂÆöÁæ©
        function getAccentColor(job) {
            if(!job) return '#555555'; // Gray
            if(job.includes('Êé¢ÂÅµ') || job.includes('Ë≠¶ÂÆò') || job.includes('ÊçúÊüª')) return '#00f3ff'; // Cyan
            if(job.includes('Âåª') || job.includes('Â≠¶ËÄÖ') || job.includes('Á†îÁ©∂')) return '#ffd700'; // Yellow
            if(job.includes('Êà¶') || job.includes('Ëá™Ë°õ') || job.includes('Áã©')) return '#ff2a2a'; // Red
            if(job.includes('„Ç¢„Ç§„Éâ„É´') || job.includes('Â≠¶Áîü')) return '#ff00ff'; // Magenta
            return '#00f3ff'; // Default Cyan
        }

        window.renderCharacterList = function(data) {
            stage.innerHTML = ''; 

            if (!data || Object.keys(data).length === 0) {
                stage.innerHTML = '<div class="loading-text">NO DATA FOUND</div>';
                return;
            }

            Object.values(data).forEach(char => {
                const unit = document.createElement('div');
                unit.className = 'char-unit';
                
                const imgSource = char.image || 'https://placehold.co/300x600/111/444?text=NO+IMG';
                const accentColor = getAccentColor(char.job);
                
                // HTMLÊßãÈÄ†: 3D„É¨„Ç§„É§„ÉºÔºà„É¢„Éã„Çø„Éº„ÉªÂ∫ä„Éª„Éï„Ç£„ÇÆ„É•„Ç¢Ôºâ
                unit.innerHTML = `
                    <!-- 1. BACK SCREEN (Monitor) -->
                    <div class="unit-monitor" style="border-color: ${accentColor}44;">
                        <div class="monitor-frame" style="border-color: ${accentColor};"></div>
                        <div class="monitor-corner mc-tl" style="border-color: ${accentColor};"></div>
                        <div class="monitor-corner mc-br" style="border-color: ${accentColor};"></div>
                        <div class="scanlines"></div>
                        <!-- ËÉåÊôØÁîªÂÉè„Å®„Åó„Å¶È°îÂë®Ëæ∫„ÇíÊã°Â§ßË°®Á§∫ -->
                        <div class="monitor-img" style="background-image: url('${imgSource}');"></div>
                    </div>

                    <!-- 2. FLOOR GLOW -->
                    <div class="unit-floor" style="background: radial-gradient(circle, ${accentColor}44 0%, transparent 70%);"></div>

                    <!-- 3. FIGURE & SHADOW -->
                    <div class="char-shadow-real"></div>
                    <div class="unit-figure-wrapper">
                        <img src="${imgSource}" class="char-img" alt="${char.name}" onerror="this.style.opacity='0'">
                    </div>

                    <!-- 4. FLOATING UI -->
                    <div class="unit-info">
                        <div class="info-job" style="background: ${accentColor};">${char.job || 'UNKNOWN'}</div>
                        <div class="info-name" style="border-left-color: ${accentColor};">${char.name}</div>
                    </div>

                    <!-- CONTROLS -->
                    <div class="edit-img-btn" title="Edit Image">üì∑</div>
                    <div class="click-overlay"></div>
                `;

                // --- Events ---

                // ÁîªÂÉèÁ∑®ÈõÜ
                const editBtn = unit.querySelector('.edit-img-btn');
                editBtn.onclick = (e) => {
                    e.stopPropagation();
                    const newUrl = prompt(`„ÄêÁîªÂÉèURLË®≠ÂÆö„Äë\n${char.name} „ÅÆÁ´ã„Å°ÁµµURL„ÇíÂÖ•Âäõ:`, char.image || "");
                    if(newUrl !== null) {
                        char.image = newUrl;
                        saveToCloud(char).then(() => {
                            // Á∞°Êòì„É™„É≠„Éº„ÉâÔºàÊú¨Êù•„ÅØÂ∑ÆÂàÜÊõ¥Êñ∞„ÅåÊúõ„Åæ„Åó„ÅÑÔºâ
                            window.renderCharacterList(data);
                        });
                    }
                };

                // Ë©≥Á¥∞„Éö„Éº„Ç∏„Å∏ÈÅ∑Áßª
                const clickArea = unit.querySelector('.click-overlay');
                clickArea.onclick = () => {
                    // ID„Çí„ÇØ„Ç®„É™„Éë„É©„É°„Éº„Çø„Å®„Åó„Å¶Ê∏°„Åô
                    window.location.href = `character/detail/detail.html?id=${char.id}`;
                };

                stage.appendChild(unit);
            });
            
            // ÊèèÁîªÂæå„Å´Â∞ë„Åó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Åï„Åõ„Çã
            setTimeout(() => {
                const figures = document.querySelectorAll('.char-img');
                figures.forEach(img => img.style.opacity = '1');
            }, 100);
        };

        // Scroll Logic
        const btnPrev = document.getElementById('btnPrev');
        const btnNext = document.getElementById('btnNext');
        const SCROLL_AMOUNT = 300; // „Ç´„Éº„ÉâÂπÖ + gap
        
        btnNext.onclick = () => {
            stage.scrollBy({ left: SCROLL_AMOUNT, behavior: 'smooth' });
        };
        btnPrev.onclick = () => {
            stage.scrollBy({ left: -SCROLL_AMOUNT, behavior: 'smooth' });
        };

        // Particle System
        function createParticle() {
            const p = document.createElement('div');
            p.className = 'particle';
            const size = Math.random() * 2 + 1;
            p.style.width = size + 'px'; p.style.height = size + 'px';
            p.style.left = Math.random() * 100 + '%';
            p.style.animationDuration = (Math.random() * 5 + 4) + 's';
            p.style.boxShadow = `0 0 ${Math.random()*5}px rgba(0, 243, 255, 0.5)`;
            document.getElementById('particles').appendChild(p);
            
            setTimeout(() => p.remove(), 8000);
        }
        setInterval(createParticle, 300);

        // Debug/Initial Load (ÂÆüÈöõ„ÅÆ„Éá„Éº„ÇøÂèñÂæó„É≠„Ç∏„ÉÉ„ÇØ„Å´Âêà„Çè„Åõ„Å¶„Åè„Å†„Åï„ÅÑ)
        // loadFromCloud().then(data => renderCharacterList(data)); 
    </script>
</body>
</html>