<!-- --- START OF FILE list.html --- -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQUAD SELECT - DATABASE</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Teko:wght@400;600&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <link href="list/header.css" rel="stylesheet">

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg-color: #050505;
            --card-width: 300px; 
            --card-height: 75vh; 
            --gap: 50px;
            
            /* Colors */
            --neon-cyan: #00f3ff;
            --neon-gold: #ffd700;
            --neon-crimson: #ff2a2a;
            --glass-panel: rgba(10, 15, 20, 0.85);
            
            /* 3D Depth Config */
            --z-screen: -50px;
            --z-figure: 30px;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(circle at 50% 120%, #203a43 0%, #000 60%),
                linear-gradient(0deg, rgba(0,243,255,0.02) 1px, transparent 1px);
            background-size: 100% 100%, 100% 40px;
            font-family: 'Rajdhani', 'Noto Sans JP', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex; flex-direction: column;
            color: #fff;
            user-select: none;
        }

        /* --- UI ELEMENTS --- */
        .sub-header {
            flex-shrink: 0; height: 60px; width: 100%;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; box-sizing: border-box;
            background: linear-gradient(90deg, rgba(0,0,0,0.8) 0%, rgba(0,20,30,0.5) 50%, rgba(0,0,0,0.8) 100%);
            border-bottom: 1px solid rgba(255,255,255,0.15);
            font-family: 'Teko', sans-serif; letter-spacing: 0.2em; font-size: 1.4rem;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        /* --- STAGE AREA --- */
        .stage-wrapper {
            flex: 1; position: relative; width: 100%;
            display: flex; align-items: center; justify-content: center;
            perspective: 1200px;
            overflow: hidden;
        }

        /* ËÉåÊôØ„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Ç∞„É™„ÉÉ„Éâ */
        .bg-grid {
            position: absolute; width: 200%; height: 200%;
            top: -50%; left: -50%;
            background: 
                linear-gradient(rgba(0,243,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,243,255,0.05) 1px, transparent 1px);
            background-size: 100px 100px;
            transform: perspective(500px) rotateX(60deg);
            animation: moveGrid 20s linear infinite;
            z-index: 0; pointer-events: none;
        }
        @keyframes moveGrid { from { transform: perspective(500px) rotateX(60deg) translateY(0); } to { transform: perspective(500px) rotateX(60deg) translateY(100px); } }

        .stage-container {
            display: flex; align-items: center;
            padding: 0 50vw; /* ÊúÄÂàù„ÅÆ„Ç¢„Ç§„ÉÜ„É†„Çí‰∏≠Â§Æ„Å´„Åô„Çã„Åü„ÇÅ */
            overflow-x: auto; overflow-y: visible;
            scroll-behavior: smooth;
            height: 100%; width: 100%;
            transform-style: preserve-3d;
            scrollbar-width: none;
            scroll-snap-type: x mandatory;
        }
        .stage-container::-webkit-scrollbar { display: none; }

        /* --- CHARACTER UNIT --- */
        .char-unit {
            flex: 0 0 var(--card-width);
            height: var(--card-height);
            margin: 0 var(--gap);
            position: relative;
            transform-style: preserve-3d;
            scroll-snap-align: center;
            cursor: pointer;
            transition: transform 0.4s ease;
        }

        /* 1. SCREEN (Top Back) */
        .unit-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 65%; /* ‰∏äÈÉ®65%„Çí‰ΩøÁî® */
            background: #000;
            border: 1px solid rgba(255,255,255,0.2);
            transform: translateZ(var(--z-screen));
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            transition: all 0.5s ease;
        }
        
        .screen-img {
            width: 100%; height: 100%;
            background-size: 180%; /* È°î„ÅåË¶ã„Åà„Çã„Çà„ÅÜË∂ÖÊã°Â§ß */
            background-position: center 20%; /* ‰∏ä„ÅÆÊñπÔºàÈ°îÔºâ„ÇíË°®Á§∫ */
            opacity: 0.5;
            filter: grayscale(1) contrast(1.2) brightness(0.6);
            transition: all 0.5s ease;
        }
        
        /* Ëµ∞ÊüªÁ∑ö„Å®„Éé„Ç§„Ç∫ */
        .scanlines {
            position: absolute; inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.5) 3px);
            pointer-events: none; z-index: 5;
        }
        .screen-glitch {
            position: absolute; inset: 0;
            background: rgba(0,243,255,0.1);
            opacity: 0; pointer-events: none; mix-blend-mode: overlay;
        }

        /* 2. INFO (Top of Screen) */
        .screen-header {
            position: absolute; top: 0; left: 0; width: 100%;
            height: 50px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            z-index: 10;
            display: flex; flex-direction: column; justify-content: flex-start;
            padding: 10px 15px; box-sizing: border-box;
        }
        .info-job {
            font-size: 0.7rem; color: var(--neon-cyan); letter-spacing: 0.2em;
            text-transform: uppercase; font-weight: bold;
            display: flex; align-items: center; gap: 5px;
        }
        .info-job::before { content: ''; display: block; width: 8px; height: 8px; background: currentColor; border-radius: 50%; box-shadow: 0 0 5px currentColor; }
        .info-name {
            font-size: 1.6rem; font-weight: 700; color: #fff;
            line-height: 1; margin-top: 2px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* 3. FIGURE (Bottom Front) */
        .unit-figure-wrapper {
            position: absolute;
            bottom: 0; left: 50%; width: 100%; height: 45%; /* ‰∏ãÈÉ®45%„Çí‰ΩøÁî®ÔºàÂ∞è„Åï„ÅèÔºâ */
            transform: translateX(-50%) translateZ(var(--z-figure));
            display: flex; align-items: flex-end; justify-content: center;
            pointer-events: none;
            z-index: 20;
        }
        .char-figure {
            max-height: 100%; max-width: 150%;
            object-fit: contain;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.8));
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            /* Â∞ë„ÅóË∂≥ÂÖÉ„ÇíÊöó„Åè„Åó„Å¶Ë®≠ÁΩÆÊÑü„ÇíÂá∫„Åô */
            mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
        }

        /* 4. BASE & SHADOW */
        .unit-base {
            position: absolute; bottom: 0; left: 50%;
            width: 180px; height: 180px;
            transform: translateX(-50%) rotateX(70deg) translateZ(-20px);
            pointer-events: none;
        }
        /* ÂõûËª¢„Åô„Çã„Éõ„É≠„Ç∞„É©„É†Âè∞Â∫ß */
        .base-ring {
            position: absolute; inset: 0; border-radius: 50%;
            border: 2px dashed var(--neon-cyan);
            opacity: 0.3;
            animation: spin 10s linear infinite;
        }
        .base-glow {
            position: absolute; inset: 20%; border-radius: 50%;
            background: radial-gradient(circle, var(--neon-cyan) 0%, transparent 70%);
            opacity: 0.2; filter: blur(10px);
            animation: pulseGlow 2s ease-in-out infinite alternate;
        }
        /* „É™„Ç¢„É´„Å™ÂΩ± */
        .base-shadow {
            position: absolute; inset: 25%;
            background: #000; border-radius: 50%;
            filter: blur(8px); opacity: 0.9;
        }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes pulseGlow { from { opacity: 0.2; transform: scale(1); } to { opacity: 0.5; transform: scale(1.2); } }

        /* --- HOVER ANIMATION --- */
        .char-unit:hover .unit-screen {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 40px rgba(0,243,255,0.15);
        }
        .char-unit:hover .screen-img {
            opacity: 1; filter: grayscale(0);
            background-size: 190%; /* „Åï„Çâ„Å´„Ç∫„Éº„É† */
        }
        .char-unit:hover .info-job {
            text-shadow: 0 0 8px currentColor;
        }
        .char-unit:hover .char-figure {
            transform: scale(1.1) translateY(-10px); /* ÊµÆ„Åç‰∏ä„Åå„Çã */
            filter: drop-shadow(0 20px 20px rgba(0,0,0,0.8)) brightness(1.1);
        }
        .char-unit:hover .base-ring {
            opacity: 0.8; border-style: solid; box-shadow: 0 0 15px var(--neon-cyan);
            animation-duration: 3s; /* È´òÈÄüÂõûËª¢ */
        }
        
        /* „Çπ„ÇØ„É™„Éº„É≥‰∏ä„ÅÆ„Ç∞„É™„ÉÉ„ÉÅÊºîÂá∫Ôºà„Éõ„Éê„ÉºÊôÇÔºâ */
        .char-unit:hover .screen-glitch {
            animation: glitchEffect 2s infinite;
        }
        @keyframes glitchEffect {
            0% { opacity: 0; transform: translate(0); }
            2% { opacity: 0.8; transform: translate(-2px, 2px); }
            4% { opacity: 0; transform: translate(0); }
            95% { opacity: 0; }
            96% { opacity: 0.8; transform: translate(2px, -2px); }
            98% { opacity: 0; }
        }

        /* --- CONTROLS --- */
        .nav-arrow {
            position: absolute; top: 50%; 
            width: 50px; height: 50px;
            border: 2px solid rgba(255,255,255,0.2);
            color: var(--neon-cyan);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; cursor: pointer; z-index: 100;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
            transition: 0.3s;
            clip-path: polygon(20% 0, 100% 0, 100% 80%, 80% 100%, 0 100%, 0 20%);
        }
        .nav-arrow:hover { 
            background: rgba(0,243,255,0.1); border-color: var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan);
        }
        .prev { left: 40px; }
        .next { right: 40px; }

        .edit-btn {
            position: absolute; top: 10px; right: 10px; z-index: 200;
            width: 30px; height: 30px; background: #222; border: 1px solid #444; color: #fff;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; cursor: pointer; transition: 0.2s;
        }
        .char-unit:hover .edit-btn { opacity: 1; }

        .click-layer { position: absolute; inset: 0; z-index: 50; }

        /* PARTICLES */
        #particles { position: absolute; inset: 0; pointer-events: none; z-index: 1; }
        .particle {
            position: absolute; background: white; border-radius: 50%;
            animation: floatUp linear infinite;
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            20% { opacity: 0.5; }
            100% { transform: translateY(-20vh) scale(1); opacity: 0; }
        }

    </style>
</head>
<body>

<script type="module">
    import { initHeader } from "./header.js"; 
    initHeader();
</script>

    <div class="sub-header">
        <div style="display: flex; flex-direction: column;">
            <span style="line-height: 1; font-size: 1.2rem; color:#fff;">CHARACTER SELECT</span>
            <span style="font-size: 0.7rem; color: var(--neon-cyan); letter-spacing: 0.1em;">// DATABASE CONNECTED</span>
        </div>
        <div style="font-family:'Rajdhani'; font-size: 0.9rem; opacity: 0.7;">SELECT TARGET > DEPLOY</div>
    </div>
    
    <div class="stage-wrapper">
        <div class="bg-grid"></div>
        <div id="particles"></div>

        <div class="nav-arrow prev" id="btnPrev">‚óÄ</div>
        
        <div class="stage-container" id="stage">
            <!-- JS„Åß„Åì„Åì„Å´„Ç≠„É£„É©„Ç´„Éº„Éâ„ÅåÁîüÊàê„Åï„Çå„Åæ„Åô -->
            <div style="width:100%; text-align:center; color:#555; font-size:2rem; font-family:'Teko'; letter-spacing:5px;">INITIALIZING...</div>
        </div>
        
        <div class="nav-arrow next" id="btnNext">‚ñ∂</div>
    </div>

    <!-- Footer -->
    <div style="height:30px; background:#000; border-top:1px solid #222; display:flex; align-items:center; justify-content:center;">
        <span style="color:#444; font-size:0.7rem; letter-spacing:0.2em;">SYSTEM STABLE // READY FOR INPUT</span>
    </div>

    <script type="module">
        import { loadFromCloud, saveToCloud } from "./firestore.js";

        const stage = document.getElementById('stage');

        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÁîüÊàê
        function spawnParticles() {
            const container = document.getElementById('particles');
            const count = 40;
            for(let i=0; i<count; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                const size = Math.random() * 3 + 1;
                p.style.width = size + 'px'; p.style.height = size + 'px';
                p.style.left = Math.random() * 100 + '%';
                p.style.opacity = Math.random() * 0.5;
                p.style.boxShadow = `0 0 ${size*2}px rgba(0,243,255,0.5)`;
                const duration = Math.random() * 10 + 5;
                p.style.animation = `floatUp ${duration}s linear infinite`;
                p.style.animationDelay = `-${Math.random() * 10}s`;
                container.appendChild(p);
            }
        }
        spawnParticles();

        function getColor(job) {
            if(!job) return '#00f3ff';
            if(job.includes('Êé¢ÂÅµ') || job.includes('Ë≠¶')) return '#00f3ff'; // Cyan
            if(job.includes('Âåª') || job.includes('Â≠¶')) return '#ffd700'; // Gold
            if(job.includes('Êà¶') || job.includes('Áã©')) return '#ff2a2a'; // Red
            if(job.includes('È≠î') || job.includes('„Ç¢')) return '#d000ff'; // Purple
            return '#00f3ff';
        }

        window.renderCharacterList = function(data) {
            stage.innerHTML = ''; 
            
            // ‰ΩôÁôΩÁî®„Çπ„Éö„Éº„Çµ„ÉºÔºà‰∏≠Â§ÆÂØÑ„Åõ„ÅÆ„Åü„ÇÅÔºâ
            const spacerStart = document.createElement('div');
            spacerStart.style.minWidth = "50vw";
            stage.appendChild(spacerStart);

            if (!data || Object.keys(data).length === 0) {
                stage.innerHTML = '<div style="color:white; text-align:center;">NO DATA</div>';
                return;
            }

            Object.values(data).forEach((char, index) => {
                const unit = document.createElement('div');
                unit.className = 'char-unit';
                
                // ÁôªÂ†¥„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Áî®„ÅÆÈÅÖÂª∂
                unit.style.opacity = '0';
                unit.style.animation = `fadeInUp 0.6s ease forwards ${index * 0.1}s`;

                const imgUrl = char.image || 'https://placehold.co/400x800/222/555?text=NO+IMG';
                const accent = getColor(char.job);

                unit.innerHTML = `
                    <!-- 1. SCREEN (Background/Top) -->
                    <div class="unit-screen" style="border-color: ${accent}44;">
                        <div class="screen-img" style="background-image: url('${imgUrl}');"></div>
                        <div class="scanlines"></div>
                        <div class="screen-glitch"></div>
                        
                        <!-- Header Info Inside Screen -->
                        <div class="screen-header">
                            <div class="info-job" style="color:${accent};">${char.job || 'UNKNOWN'}</div>
                            <div class="info-name">${char.name}</div>
                        </div>
                    </div>

                    <!-- 2. BASE (Shadow & Light) -->
                    <div class="unit-base">
                        <div class="base-shadow"></div>
                        <div class="base-ring" style="border-color:${accent}; box-shadow:0 0 10px ${accent};"></div>
                        <div class="base-glow" style="background: radial-gradient(circle, ${accent} 0%, transparent 70%);"></div>
                    </div>

                    <!-- 3. FIGURE (Foreground/Bottom) -->
                    <div class="unit-figure-wrapper">
                        <img src="${imgUrl}" class="char-figure" alt="${char.name}">
                    </div>

                    <!-- Controls -->
                    <div class="edit-btn">üì∑</div>
                    <div class="click-layer"></div>
                `;
                
                // „Ç§„Éô„É≥„ÉàË®≠ÂÆö
                const editBtn = unit.querySelector('.edit-btn');
                editBtn.onclick = (e) => {
                    e.stopPropagation();
                    const newUrl = prompt('ÁîªÂÉèURL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', char.image || "");
                    if(newUrl) {
                        char.image = newUrl;
                        saveToCloud(char).then(() => renderCharacterList(data));
                    }
                };

                const clickLayer = unit.querySelector('.click-layer');
                clickLayer.onclick = () => {
                    window.location.href = `character/detail/detail.html?id=${char.id}`;
                };

                stage.appendChild(unit);
            });

            // ÁµÇ‰∫Ü„Çπ„Éö„Éº„Çµ„Éº
            const spacerEnd = document.createElement('div');
            spacerEnd.style.minWidth = "50vw";
            stage.appendChild(spacerEnd);
        };

        // Scroll Logic
        const btnNext = document.getElementById('btnNext');
        const btnPrev = document.getElementById('btnPrev');
        
        btnNext.onclick = () => {
            const unitW = document.querySelector('.char-unit')?.offsetWidth || 300;
            stage.scrollBy({ left: unitW + 50, behavior: 'smooth' });
        };
        btnPrev.onclick = () => {
            const unitW = document.querySelector('.char-unit')?.offsetWidth || 300;
            stage.scrollBy({ left: -(unitW + 50), behavior: 'smooth' });
        };

        // CSS Animation Keyframes for entry
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(50px) rotateX(10deg); }
                to { opacity: 1; transform: translateY(0) rotateX(0); }
            }
        `;
        document.head.appendChild(styleSheet);

        // Debug Load
        // loadFromCloud().then(renderCharacterList);
    </script>
</body>
</html>